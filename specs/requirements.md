# 四象限MCP服务器 - 需求文档

## 项目概述

四象限MCP服务器是一个基于Model Context Protocol（MCP）协议的时间管理工具服务器，采用桥接架构设计。项目的核心目标是为四象限Android时间管理应用提供AI功能接口，使用户能够通过AI助手进行智能的时间管理和任务规划。

### 项目愿景
创建一个智能化的时间管理系统，通过AI助手帮助用户更好地管理时间、规划任务，提高工作效率。系统基于经典的四象限理论（重要性×紧急性），为用户提供科学的任务分类和时间分配建议。

## 系统架构

### 架构设计
```
MCP客户端(Cursor/AI助手) ←→ MCP服务器(Python) ←→ Android HTTP服务器 ←→ Android AI功能模块
```

### 核心组件
1. **MCP服务器**: 运行在PC端，使用Python实现，符合MCP协议标准
2. **Android桥接**: Android设备运行HTTP服务器，接收MCP服务器的API调用
3. **通信方式**: PC和Android通过WiFi网络进行HTTP JSON通信

## 功能需求

### 1. 番茄钟管理模块

#### 1.1 启动番茄钟 (start_pomodoro)
- **功能描述**: 启动番茄钟计时器，开始专注工作时间
- **输入参数**:
  - `task_name` (必需): 任务名称，描述当前要执行的工作
  - `duration` (可选): 番茄钟时长，默认25分钟
  - `task_id` (可选): 关联的任务ID，用于统计和跟踪
- **功能要求**:
  - 支持自定义番茄钟时长（5-60分钟）
  - 自动关联任务记录
  - 生成唯一的番茄钟会话ID
  - 记录开始时间和预期结束时间

#### 1.2 控制番茄钟 (control_pomodoro)
- **功能描述**: 控制当前番茄钟的状态
- **输入参数**:
  - `action` (必需): 操作类型 - pause（暂停）、resume（恢复）、stop（停止）、status（状态查询）
  - `reason` (可选): 操作原因，用于记录和分析
- **功能要求**:
  - 支持暂停和恢复计时
  - 支持提前停止番茄钟
  - 提供实时状态查询
  - 记录操作历史和原因

#### 1.3 休息管理 (manage_break)
- **功能描述**: 管理番茄钟间的休息时间
- **输入参数**:
  - `action` (必需): start（开始休息）、skip（跳过休息）
- **功能要求**:
  - 短休息（5分钟）和长休息（15-30分钟）
  - 支持跳过休息直接开始下一个番茄钟
  - 休息时间自动倒计时
  - 休息结束提醒

### 2. 任务管理模块

#### 2.1 四象限任务管理 (manage_tasks)
- **功能描述**: 基于重要性和紧急性的四象限任务分类管理
- **输入参数**:
  - `action` (必需): create（创建）、update（更新）、delete（删除）、list（列表）、complete（完成）
  - `task_data` (条件必需): 任务数据对象
  - `task_id` (条件必需): 任务唯一标识
- **任务数据结构**:
  - `name`: 任务名称
  - `description`: 任务描述
  - `importance`: 重要性等级（1-4级）
  - `urgency`: 紧急性等级（1-4级）
  - `due_date`: 截止日期
  - `status`: 任务状态（pending、in_progress、completed、cancelled）
  - `estimated_pomodoros`: 预计需要的番茄钟数量
- **四象限分类**:
  - 第一象限（重要且紧急）: importance >= 3 && urgency >= 3
  - 第二象限（重要不紧急）: importance >= 3 && urgency < 3
  - 第三象限（不重要紧急）: importance < 3 && urgency >= 3
  - 第四象限（不重要不紧急）: importance < 3 && urgency < 3

### 3. 统计分析模块

#### 3.1 数据统计 (get_statistics)
- **功能描述**: 提供多维度的统计数据和分析报告
- **输入参数**:
  - `type` (必需): 统计类型
    - `general`: 总体统计概览
    - `daily`: 日统计
    - `weekly`: 周统计
    - `monthly`: 月统计
    - `pomodoro`: 番茄钟专项统计
    - `tasks`: 任务完成统计
  - `period` (可选): 统计周期
  - `filters` (可选): 过滤条件
- **统计指标**:
  - 番茄钟完成数量和时长
  - 任务完成率
  - 四象限任务分布
  - 工作效率趋势
  - 专注时间分析
  - 中断次数统计

### 4. 设置管理模块

#### 4.1 系统设置 (update_settings)
- **功能描述**: 更新系统配置和用户偏好设置
- **输入参数**:
  - `dark_mode` (可选): 深色模式开关
  - `tomato_duration` (可选): 默认番茄钟时长（分钟）
  - `break_duration` (可选): 默认休息时长（分钟）
  - `notification_enabled` (可选): 通知开关
  - `auto_start_break` (可选): 自动开始休息
  - `sound_enabled` (可选): 声音提醒开关
- **配置分类**:
  - 界面设置: 主题、语言、显示偏好
  - 番茄钟设置: 时长、提醒方式、自动化规则
  - 通知设置: 类型、频率、静音时段

### 5. 系统监控模块

#### 5.1 Android状态检查 (check_android_status)
- **功能描述**: 实时监控Android设备连接状态和功能可用性
- **功能要求**:
  - 网络连接状态检查
  - Android HTTP服务器响应检查
  - 功能模块可用性验证
  - 性能指标监控
  - 错误状态报告

## 技术需求

### 开发环境
- **Python版本**: 3.8+
- **核心依赖库**:
  - `mcp`: MCP协议支持
  - `aiohttp`: 异步HTTP客户端
  - `pydantic`: 数据验证和序列化

### Android端要求
- **HTTP服务器**: 监听8080端口
- **API端点**: `/api/command/execute`
- **网络权限**: 允许WiFi网络通信
- **CORS支持**: 跨域请求处理

### 通信协议
#### 请求格式
```json
{
  "command": "start_pomodoro",
  "args": {
    "task_name": "学习Python编程",
    "duration": 25,
    "task_id": "task_001"
  }
}
```

#### 响应格式
```json
{
  "success": true,
  "message": "🍅 番茄钟启动成功！",
  "data": {
    "session_id": "session_123",
    "start_time": 1703123456,
    "end_time": 1703124956
  },
  "timestamp": 1703123456
}
```

### 网络配置
- **默认IP**: 192.168.1.100
- **端口**: 8080
- **超时时间**: 10秒
- **重试机制**: 3次重试，指数退避

## 非功能性需求

### 可靠性
- 网络异常时的容错处理
- 数据持久化和恢复
- 异常情况下的优雅降级

### 性能
- API响应时间 < 2秒
- 支持并发请求处理
- 内存使用优化

### 用户体验
- 友好的中文响应信息
- 丰富的emoji表情符号
- 清晰的错误提示和解决建议

### 安全性
- 网络通信加密（可选）
- 参数验证和清理
- 访问控制和权限管理

## 项目结构

```
fourquadrant-mcp/
├── mcp_server.py          # MCP服务器主程序
├── requirements.txt       # Python依赖包
├── config.json           # 配置文件
├── test_server.py        # 测试脚本
├── start_server.bat      # Windows启动脚本
├── start_server.sh       # Linux启动脚本
├── README.md             # 项目说明文档
└── android/
    └── AndroidHttpServer.java  # Android HTTP服务器
```

## 交付标准

### 代码质量
- 完整的代码注释（中文）
- 符合PEP 8编码规范
- 完善的错误处理机制
- 单元测试覆盖率 > 80%

### 文档要求
- 详细的安装和配置说明
- API使用示例和最佳实践
- 常见问题和故障排除指南
- 系统架构和设计说明

### 测试要求
- 功能测试：所有MCP工具正常工作
- 集成测试：PC端与Android端通信正常
- 性能测试：满足响应时间要求
- 兼容性测试：支持主流Android设备

## 成功标准

1. **功能完整性**: 所有7个MCP工具功能正常实现
2. **通信稳定性**: PC与Android设备通信稳定可靠
3. **用户体验**: 界面友好，操作简单直观
4. **性能指标**: 满足响应时间和并发要求
5. **代码质量**: 代码规范，注释完整，易于维护
6. **文档完善**: 说明文档详细，示例丰富

此需求文档将作为项目开发的基础规范，确保最终交付的产品能够满足用户需求和技术要求。
